<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel=stylesheet><link rel=stylesheet type=text/css href=/css/style.css><title>HRPC</title><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/favicons/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60127042-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60127042-1');</script></head><body><div id=landing-content><div class=row><div class=topbannersub><nav class="navbar navbar-expand-md navbar-dark topnav"><a class=navbar-brand href=/><img src=/img/grpc-logo.png width=114 height=50></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="topnav, collapse navbar-collapse" id=navbarSupportedContent style=float:right!important><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class="nav-item dropdown active"><a class="nav-link dropdown-toggle" href=/docs/ id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Docs</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/hrpc-docs/docs>Overview</a>
<a class=dropdown-item href=/hrpc-docs/docs/quickstart/>Quick Start</a>
<a class=dropdown-item href=/hrpc-docs/docs/guides/>Guides</a>
<a class=dropdown-item href=/hrpc-docs/docs/tutorials/>Tutorials</a>
<a class=dropdown-item href=/hrpc-docs/docs/reference/>Reference</a>
<a class=dropdown-item href=/hrpc-docs/docs/samples/>Samples</a>
<a class=dropdown-item href=/hrpc-docs/docs/talks>Presentations</a></div></li><li class=nav-item><a class=nav-link href=/blog>Blog</a></li><li class=nav-item><a class=nav-link href=/community>Community</a></li><li class=nav-item><a class=nav-link href=https://packages.grpc.io/>Packages</a></li><li class=nav-item><a class=nav-link href=/faq/>FAQ</a></li></ul></div></nav><div class=headertext>Documentation</div></div></div></div><div class="subnav d-none d-md-block"><a href=/docs>Overview</a>
|
<a href=/hrpc-docs/docs/quickstart/>Quick Start</a>
|
<a href=/hrpc-docs/docs/guides/ class=active>Guides</a>
|
<a href=/hrpc-docs/docs/tutorials/>Tutorials</a>
|
<a href=/hrpc-docs/docs/reference/>Reference</a></div><div class=quickstartcols><div class=quickstartcol1><h8>Guides</h8>
<a href=/hrpc-docs/docs/guides/>What is HRPC?</a>
<a href=/hrpc-docs/docs/guides/concepts/>HRPC Concepts</a>
<a href=/hrpc-docs/docs/guides/auth/ class=active>Authentication</a>
<a href=/hrpc-docs/docs/guides/error/>Error handling and debugging</a>
<a href=/hrpc-docs/docs/guides/benchmarking/>Benchmarking</a>
<a href=https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md>HRPC Wire Format</a>
<h8 style=margin-top:25%>Related Guides</h8>
<a href=https://developers.google.com/protocol-buffers/docs/overview>Protocol Buffers</a></div><div class=quickstartcol2 style=margin-top:4%><h3 style=margin-top:0>Authentication</h3><p class=lead>This document provides an overview of HRPC authentication, including our built-in supported auth mechanisms, how to plug in your own authentication systems, and examples of how to use HRPC auth in our supported languages.</p><h3 id=overview>Overview</h3><p>HRPC is designed to work with a variety of authentication mechanisms, making it
easy to safely use HRPC to talk to other systems. You can use our supported
mechanisms - SSL/TLS with or without Google token-based authentication - or you
can plug in your own authentication system by extending our provided code.</p><p>HRPC also provides a simple authentication API that lets you provide all the
necessary authentication information as <code>Credentials</code> when creating a channel or
making a call.</p><h3 id=supported-auth-mechanisms>Supported auth mechanisms</h3><p>The following authentication mechanisms are built-in to HRPC:</p><ul><li><strong>SSL/TLS</strong>: HRPC has SSL/TLS integration and promotes the use of SSL/TLS
to authenticate the server, and to encrypt all the data exchanged between
the client and the server. Optional mechanisms are available for clients to
provide certificates for mutual authentication.</li><li><strong>Token-based authentication with Google</strong>: HRPC provides a generic
mechanism (described below) to attach metadata based credentials to requests
and responses. Additional support for acquiring access tokens
(typically OAuth2 tokens) while accessing Google APIs through HRPC is
provided for certain auth flows: you can see how this works in our code
examples below. In general this mechanism must be used <em>as well as</em> SSL/TLS
on the channel - Google will not allow connections without SSL/TLS, and
most HRPC language implementations will not let you send credentials on an
unencrypted channel.</li></ul><h3 id=authentication-api>Authentication API</h3><p>HRPC provides a simple authentication API based around the unified concept of
Credentials objects, which can be used when creating an entire HRPC channel or
an individual call.</p><h4 id=credential-types>Credential types</h4><p>Credentials can be of two types:</p><ul><li><strong>Channel credentials</strong>, which are attached to a <code>Channel</code>, such as SSL
credentials.</li><li><strong>Call credentials</strong>, which are attached to a call (or <code>ClientContext</code> in
C++).</li></ul><p>You can also combine these in a <code>CompositeChannelCredentials</code>, allowing you to
specify, for example, SSL details for the channel along with call credentials
for each call made on the channel. A <code>CompositeChannelCredentials</code> associates a
<code>ChannelCredentials</code> and a <code>CallCredentials</code> to create a new
<code>ChannelCredentials</code>. The result will send the authentication data associated
with the composed <code>CallCredentials</code> with every call made on the channel.</p><p>For example, you could create a <code>ChannelCredentials</code> from an <code>SslCredentials</code>
and an <code>AccessTokenCredentials</code>. The result when applied to a <code>Channel</code> would
send the appropriate access token for each call on this channel.</p><p>Individual <code>CallCredentials</code> can also be composed using
<code>CompositeCallCredentials</code>. The resulting <code>CallCredentials</code> when used in a call
will trigger the sending of the authentication data associated with the two
<code>CallCredentials</code>.</p><h4 id=using-clientside-ssltls>Using client-side SSL/TLS</h4><p>Now let's look at how <code>Credentials</code> work with one of our supported auth
mechanisms. This is the simplest authentication scenario, where a client just
wants to authenticate the server and encrypt all data. The example is in C++,
but the API is similar for all languages: you can see how to enable SSL/TLS in
more languages in our Examples section below.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// Create a default SSL ChannelCredentials object.
</span><span style=color:#75715e></span><span style=color:#66d9ef>auto</span> channel_creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>SslCredentials(grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>SslCredentialsOptions());
<span style=color:#75715e>// Create a channel using the credentials created in the previous step.
</span><span style=color:#75715e></span><span style=color:#66d9ef>auto</span> channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>CreateChannel(server_name, channel_creds);
<span style=color:#75715e>// Create a stub on the channel.
</span><span style=color:#75715e></span>std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Stub<span style=color:#f92672>&gt;</span> stub(Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>NewStub(channel));
<span style=color:#75715e>// Make actual RPC calls on the stub.
</span><span style=color:#75715e></span>grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Status s <span style=color:#f92672>=</span> stub<span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span>sayHello(<span style=color:#f92672>&amp;</span>context, <span style=color:#f92672>*</span>request, response);
</code></pre></div><p>For advanced use cases such as modifying the root CA or using client certs,
the corresponding options can be set in the <code>SslCredentialsOptions</code> parameter
passed to the factory method.</p><h4 id=using-google-tokenbased-authentication>Using Google token-based authentication</h4><p>HRPC applications can use a simple API to create a credential that works for
authentication with Google in various deployment scenarios. Again, our example
is in C++ but you can find examples in other languages in our Examples section.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>auto</span> creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>GoogleDefaultCredentials();
<span style=color:#75715e>// Create a channel, stub and make RPC calls (same as in the previous example)
</span><span style=color:#75715e></span><span style=color:#66d9ef>auto</span> channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>CreateChannel(server_name, creds);
std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Stub<span style=color:#f92672>&gt;</span> stub(Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>NewStub(channel));
grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Status s <span style=color:#f92672>=</span> stub<span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span>sayHello(<span style=color:#f92672>&amp;</span>context, <span style=color:#f92672>*</span>request, response);
</code></pre></div><p>This channel credentials object works for applications using Service Accounts as
well as for applications running in <a href=https://cloud.google.com/compute/>Google Compute Engine
(GCE)</a>. In the former case, the service
account’s private keys are loaded from the file named in the environment
variable <code>GOOGLE_APPLICATION_CREDENTIALS</code>. The keys are used to generate bearer
tokens that are attached to each outgoing RPC on the corresponding channel.</p><p>For applications running in GCE, a default service account and corresponding
OAuth2 scopes can be configured during VM setup. At run-time, this credential
handles communication with the authentication systems to obtain OAuth2 access
tokens and attaches them to each outgoing RPC on the corresponding channel.</p><h4 id=extending-hrpc-to-support-other-authentication-mechanisms>Extending HRPC to support other authentication mechanisms</h4><p>The Credentials plugin API allows developers to plug in their own type of
credentials. This consists of:</p><ul><li>The <code>MetadataCredentialsPlugin</code> abstract class, which contains the pure virtual
<code>GetMetadata</code> method that needs to be implemented by a sub-class created by
the developer.</li><li>The <code>MetadataCredentialsFromPlugin</code> function, which creates a <code>CallCredentials</code>
from the <code>MetadataCredentialsPlugin</code>.</li></ul><p>Here is example of a simple credentials plugin which sets an authentication
ticket in a custom header.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyCustomAuthenticator</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>MetadataCredentialsPlugin {
 <span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
  MyCustomAuthenticator(<span style=color:#66d9ef>const</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string<span style=color:#f92672>&amp;</span> ticket) <span style=color:#f92672>:</span> ticket_(ticket) {}

  grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Status GetMetadata(
      grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string_ref service_url, grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string_ref method_name,
      <span style=color:#66d9ef>const</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>AuthContext<span style=color:#f92672>&amp;</span> channel_auth_context,
      std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>multimap<span style=color:#f92672>&lt;</span>grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string, grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string<span style=color:#f92672>&gt;</span><span style=color:#f92672>*</span> metadata) <span style=color:#66d9ef>override</span> {
    metadata<span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span>insert(std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>make_pair(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>x-custom-auth-ticket</span><span style=color:#e6db74>&#34;</span>, ticket_));
    <span style=color:#66d9ef>return</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Status<span style=color:#f92672>:</span><span style=color:#f92672>:</span>OK;
  }

 <span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
  grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>string ticket_;
};

<span style=color:#66d9ef>auto</span> call_creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>MetadataCredentialsFromPlugin(
    std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>MetadataCredentialsPlugin<span style=color:#f92672>&gt;</span>(
        <span style=color:#66d9ef>new</span> MyCustomAuthenticator(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>super-secret-ticket</span><span style=color:#e6db74>&#34;</span>)));
</code></pre></div><p>A deeper integration can be achieved by plugging in a HRPC credentials
implementation at the core level. HRPC internals also allow switching out
SSL/TLS with other encryption mechanisms.</p><h3 id=examples>Examples</h3><p>These authentication mechanisms will be available in all HRPC's supported
languages. The following sections demonstrate how authentication and
authorization features described above appear in each language: more languages
are coming soon.</p><h4 id=go>Go</h4><h5 id=base-case--no-encryption-or-authentication>Base case - no encryption or authentication</h5><p>Client:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;localhost:50051&#34;</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithInsecure</span>())
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>NewGreeterClient</span>(<span style=color:#a6e22e>conn</span>)
<span style=color:#75715e>// ...
</span></code></pre></div><p>Server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>()
<span style=color:#a6e22e>lis</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;localhost:50051&#34;</span>)
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Serve</span>(<span style=color:#a6e22e>lis</span>)
</code></pre></div><h5 id=with-server-authentication-ssltls>With server authentication SSL/TLS</h5><p>Client:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>creds</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>NewClientTLSFromFile</span>(<span style=color:#a6e22e>certFile</span>, <span style=color:#e6db74>&#34;&#34;</span>)
<span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;localhost:50051&#34;</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithTransportCredentials</span>(<span style=color:#a6e22e>creds</span>))
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>NewGreeterClient</span>(<span style=color:#a6e22e>conn</span>)
<span style=color:#75715e>// ...
</span></code></pre></div><p>Server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>creds</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>NewServerTLSFromFile</span>(<span style=color:#a6e22e>certFile</span>, <span style=color:#a6e22e>keyFile</span>)
<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>(<span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Creds</span>(<span style=color:#a6e22e>creds</span>))
<span style=color:#a6e22e>lis</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;localhost:50051&#34;</span>)
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Serve</span>(<span style=color:#a6e22e>lis</span>)
</code></pre></div><h5 id=authenticate-with-google>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>pool</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x509</span>.<span style=color:#a6e22e>SystemCertPool</span>()
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>creds</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>NewClientTLSFromCert</span>(<span style=color:#a6e22e>pool</span>, <span style=color:#e6db74>&#34;&#34;</span>)
<span style=color:#a6e22e>perRPC</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>oauth</span>.<span style=color:#a6e22e>NewServiceAccountFromFile</span>(<span style=color:#e6db74>&#34;service-account.json&#34;</span>, <span style=color:#a6e22e>scope</span>)
<span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(
	<span style=color:#e6db74>&#34;greeter.googleapis.com&#34;</span>,
	<span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithTransportCredentials</span>(<span style=color:#a6e22e>creds</span>),
	<span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithPerRPCCredentials</span>(<span style=color:#a6e22e>perRPC</span>),
)
<span style=color:#75715e>// error handling omitted
</span><span style=color:#75715e></span><span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>NewGreeterClient</span>(<span style=color:#a6e22e>conn</span>)
<span style=color:#75715e>// ...
</span></code></pre></div><h4 id=ruby>Ruby</h4><h5 id=base-case--no-encryption-or-authentication1>Base case - no encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>
stub <span style=color:#f92672>=</span> <span style=color:#66d9ef>Helloworld</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Greeter</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Stub</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;localhost:50051&#39;</span>, <span style=color:#e6db74>:this_channel_is_insecure</span>)
<span style=color:#f92672>...</span>
</code></pre></div><h5 id=with-server-authentication-ssltls1>With server authentication SSL/TLS</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>creds <span style=color:#f92672>=</span> <span style=color:#66d9ef>GRPC</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Core</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Credentials</span><span style=color:#f92672>.</span>new(load_certs)  <span style=color:#75715e># load_certs typically loads a CA roots file</span>
stub <span style=color:#f92672>=</span> <span style=color:#66d9ef>Helloworld</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Greeter</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Stub</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;myservice.example.com&#39;</span>, creds)
</code></pre></div><h5 id=authenticate-with-google1>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>require <span style=color:#e6db74>&#39;googleauth&#39;</span>  <span style=color:#75715e># from http://www.rubydoc.info/gems/googleauth/0.1.0</span>
<span style=color:#f92672>...</span>
ssl_creds <span style=color:#f92672>=</span> <span style=color:#66d9ef>GRPC</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Core</span><span style=color:#f92672>::</span><span style=color:#66d9ef>ChannelCredentials</span><span style=color:#f92672>.</span>new(load_certs)  <span style=color:#75715e># load_certs typically loads a CA roots file</span>
authentication <span style=color:#f92672>=</span> <span style=color:#66d9ef>Google</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Auth</span><span style=color:#f92672>.</span>get_application_default()
call_creds <span style=color:#f92672>=</span> <span style=color:#66d9ef>GRPC</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Core</span><span style=color:#f92672>::</span><span style=color:#66d9ef>CallCredentials</span><span style=color:#f92672>.</span>new(authentication<span style=color:#f92672>.</span>updater_proc)
combined_creds <span style=color:#f92672>=</span> ssl_creds<span style=color:#f92672>.</span>compose(call_creds)
stub <span style=color:#f92672>=</span> <span style=color:#66d9ef>Helloworld</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Greeter</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Stub</span><span style=color:#f92672>.</span>new(<span style=color:#e6db74>&#39;greeter.googleapis.com&#39;</span>, combined_creds)
</code></pre></div><h4 id=c>C++</h4><h5 id=base-case--no-encryption-or-authentication2>Base case - no encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>auto</span> channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>CreateChannel(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>localhost:50051</span><span style=color:#e6db74>&#34;</span>, InsecureChannelCredentials());
std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Stub<span style=color:#f92672>&gt;</span> stub(Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>NewStub(channel));
...
</code></pre></div><h5 id=with-server-authentication-ssltls2>With server authentication SSL/TLS</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>auto</span> channel_creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>SslCredentials(grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>SslCredentialsOptions());
<span style=color:#66d9ef>auto</span> channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>CreateChannel(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>myservice.example.com</span><span style=color:#e6db74>&#34;</span>, channel_creds);
std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Stub<span style=color:#f92672>&gt;</span> stub(Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>NewStub(channel));
...
</code></pre></div><h5 id=authenticate-with-google2>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>auto</span> creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>GoogleDefaultCredentials();
<span style=color:#66d9ef>auto</span> channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>:</span><span style=color:#f92672>:</span>CreateChannel(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>greeter.googleapis.com</span><span style=color:#e6db74>&#34;</span>, creds);
std<span style=color:#f92672>:</span><span style=color:#f92672>:</span>unique_ptr<span style=color:#f92672>&lt;</span>Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>Stub<span style=color:#f92672>&gt;</span> stub(Greeter<span style=color:#f92672>:</span><span style=color:#f92672>:</span>NewStub(channel));
...
</code></pre></div><h4 id=c35>C#</h4><h5 id=base-case--no-encryption-or-authentication3>Base case - no encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> channel = <span style=color:#66d9ef>new</span> Channel(<span style=color:#e6db74>&#34;localhost:50051&#34;</span>, ChannelCredentials.Insecure);
<span style=color:#66d9ef>var</span> client = <span style=color:#66d9ef>new</span> Greeter.GreeterClient(channel);
...
</code></pre></div><h5 id=with-server-authentication-ssltls3>With server authentication SSL/TLS</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> channelCredentials = <span style=color:#66d9ef>new</span> SslCredentials(File.ReadAllText(<span style=color:#e6db74>&#34;roots.pem&#34;</span>));  <span style=color:#75715e>// Load a custom roots file.
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> channel = <span style=color:#66d9ef>new</span> Channel(<span style=color:#e6db74>&#34;myservice.example.com&#34;</span>, channelCredentials);
<span style=color:#66d9ef>var</span> client = <span style=color:#66d9ef>new</span> Greeter.GreeterClient(channel);
</code></pre></div><h5 id=authenticate-with-google3>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>using</span> Grpc.Auth;  <span style=color:#75715e>// from Grpc.Auth NuGet package
</span><span style=color:#75715e></span>...
<span style=color:#75715e>// Loads Google Application Default Credentials with publicly trusted roots.
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> channelCredentials = <span style=color:#66d9ef>await</span> GoogleGrpcCredentials.GetApplicationDefaultAsync();

<span style=color:#66d9ef>var</span> channel = <span style=color:#66d9ef>new</span> Channel(<span style=color:#e6db74>&#34;greeter.googleapis.com&#34;</span>, channelCredentials);
<span style=color:#66d9ef>var</span> client = <span style=color:#66d9ef>new</span> Greeter.GreeterClient(channel);
...
</code></pre></div><h5 id=authenticate-a-single-rpc-call>Authenticate a single RPC call</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> channel = <span style=color:#66d9ef>new</span> Channel(<span style=color:#e6db74>&#34;greeter.googleapis.com&#34;</span>, <span style=color:#66d9ef>new</span> SslCredentials());  <span style=color:#75715e>// Use publicly trusted roots.
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> client = <span style=color:#66d9ef>new</span> Greeter.GreeterClient(channel);
...
<span style=color:#66d9ef>var</span> googleCredential = <span style=color:#66d9ef>await</span> GoogleCredential.GetApplicationDefaultAsync();
<span style=color:#66d9ef>var</span> result = client.SayHello(request, <span style=color:#66d9ef>new</span> CallOptions(credentials: googleCredential.ToCallCredentials()));
...

</code></pre></div><h4 id=python>Python</h4><h5 id=base-case--no-encryption-or-authentication4>Base case - No encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> grpc
<span style=color:#f92672>import</span> helloworld_pb2

channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>.</span>insecure_channel(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>localhost:50051</span><span style=color:#e6db74>&#39;</span>)
stub <span style=color:#f92672>=</span> helloworld_pb2<span style=color:#f92672>.</span>GreeterStub(channel)
</code></pre></div><h5 id=with-server-authentication-ssltls4>With server authentication SSL/TLS</h5><p>Client:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> grpc
<span style=color:#f92672>import</span> helloworld_pb2

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>roots.pem</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>rb</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>as</span> f:
    creds <span style=color:#f92672>=</span> grpc<span style=color:#f92672>.</span>ssl_channel_credentials(f<span style=color:#f92672>.</span>read())
channel <span style=color:#f92672>=</span> grpc<span style=color:#f92672>.</span>secure_channel(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>myservice.example.com:443</span><span style=color:#e6db74>&#39;</span>, creds)
stub <span style=color:#f92672>=</span> helloworld_pb2<span style=color:#f92672>.</span>GreeterStub(channel)
</code></pre></div><p>Server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> grpc
<span style=color:#f92672>import</span> helloworld_pb2
<span style=color:#f92672>from</span> concurrent <span style=color:#f92672>import</span> futures

server <span style=color:#f92672>=</span> grpc<span style=color:#f92672>.</span>server(futures<span style=color:#f92672>.</span>ThreadPoolExecutor(max_workers<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>))
<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>key.pem</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>rb</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>as</span> f:
    private_key <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>chain.pem</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>rb</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>as</span> f:
    certificate_chain <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>read()
server_credentials <span style=color:#f92672>=</span> grpc<span style=color:#f92672>.</span>ssl_server_credentials( ( (private_key, certificate_chain), ) )
<span style=color:#75715e># Adding GreeterServicer to server omitted</span>
server<span style=color:#f92672>.</span>add_secure_port(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>myservice.example.com:443</span><span style=color:#e6db74>&#39;</span>, server_credentials)
server<span style=color:#f92672>.</span>start()
<span style=color:#75715e># Server sleep omitted</span>
</code></pre></div><h5 id=authenticate-with-google-using-a-jwt>Authenticate with Google using a JWT</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> grpc
<span style=color:#f92672>import</span> helloworld_pb2

<span style=color:#f92672>from</span> google <span style=color:#f92672>import</span> auth <span style=color:#66d9ef>as</span> google_auth
<span style=color:#f92672>from</span> google.auth <span style=color:#f92672>import</span> jwt <span style=color:#66d9ef>as</span> google_auth_jwt
<span style=color:#f92672>from</span> google.auth.transport <span style=color:#f92672>import</span> grpc <span style=color:#66d9ef>as</span> google_auth_transport_grpc

credentials, _ <span style=color:#f92672>=</span> google_auth<span style=color:#f92672>.</span>default()
jwt_creds <span style=color:#f92672>=</span> google_auth_jwt<span style=color:#f92672>.</span>OnDemandCredentials<span style=color:#f92672>.</span>from_signing_credentials(
    credentials)
channel <span style=color:#f92672>=</span> google_auth_transport_grpc<span style=color:#f92672>.</span>secure_authorized_channel(
    jwt_creds, None, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>greeter.googleapis.com:443</span><span style=color:#e6db74>&#39;</span>)
stub <span style=color:#f92672>=</span> helloworld_pb2<span style=color:#f92672>.</span>GreeterStub(channel)
</code></pre></div><h5 id=authenticate-with-google-using-an-oauth2-token>Authenticate with Google using an Oauth2 token</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> grpc
<span style=color:#f92672>import</span> helloworld_pb2

<span style=color:#f92672>from</span> google <span style=color:#f92672>import</span> auth <span style=color:#66d9ef>as</span> google_auth
<span style=color:#f92672>from</span> google.auth.transport <span style=color:#f92672>import</span> grpc <span style=color:#66d9ef>as</span> google_auth_transport_grpc
<span style=color:#f92672>from</span> google.auth.transport <span style=color:#f92672>import</span> requests <span style=color:#66d9ef>as</span> google_auth_transport_requests

credentials, _ <span style=color:#f92672>=</span> google_auth<span style=color:#f92672>.</span>default(scopes<span style=color:#f92672>=</span>(scope,))
request <span style=color:#f92672>=</span> google_auth_transport_requests<span style=color:#f92672>.</span>Request()
channel <span style=color:#f92672>=</span> google_auth_transport_grpc<span style=color:#f92672>.</span>secure_authorized_channel(
    credentials, request, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>greeter.googleapis.com:443</span><span style=color:#e6db74>&#39;</span>)
stub <span style=color:#f92672>=</span> helloworld_pb2<span style=color:#f92672>.</span>GreeterStub(channel)
</code></pre></div><h4 id=java>Java</h4><h5 id=base-case--no-encryption-or-authentication5>Base case - no encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>ManagedChannel channel <span style=color:#f92672>=</span> ManagedChannelBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>forAddress</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;localhost&#34;</span><span style=color:#f92672>,</span> 50051<span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>usePlaintext</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>GreeterStub</span> stub <span style=color:#f92672>=</span> GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>newStub</span><span style=color:#f92672>(</span>channel<span style=color:#f92672>)</span><span style=color:#f92672>;</span>

</code></pre></div><h5 id=with-server-authentication-ssltls5>With server authentication SSL/TLS</h5><p>In Java we recommend that you use OpenSSL when using HRPC over TLS. You can find
details about installing and using OpenSSL and other required libraries for both
Android and non-Android Java in the HRPC Java
<a href=https://github.com/grpc/grpc-java/blob/master/SECURITY.md#transport-security-tls>Security</a>
documentation.</p><p>To enable TLS on a server, a certificate chain and private key need to be
specified in PEM format. Such private key should not be using a password.
The order of certificates in the chain matters: more specifically, the certificate
at the top has to be the host CA, while the one at the very bottom
has to be the root CA. The standard TLS port is 443, but we use 8443 below to
avoid needing extra permissions from the OS.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Server server <span style=color:#f92672>=</span> ServerBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>forPort</span><span style=color:#f92672>(</span>8443<span style=color:#f92672>)</span>
    <span style=color:#75715e>// Enable TLS
</span><span style=color:#75715e></span>    <span style=color:#f92672>.</span><span style=color:#a6e22e>useTransportSecurity</span><span style=color:#f92672>(</span>certChainFile<span style=color:#f92672>,</span> privateKeyFile<span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>addService</span><span style=color:#f92672>(</span>TestServiceGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>bindService</span><span style=color:#f92672>(</span>serviceImplementation<span style=color:#f92672>)</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
server<span style=color:#f92672>.</span><span style=color:#a6e22e>start</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
</code></pre></div><p>If the issuing certificate authority is not known to the client then a properly
configured <code>SslContext</code> or <code>SSLSocketFactory</code> should be provided to the
<code>NettyChannelBuilder</code> or <code>OkHttpChannelBuilder</code>, respectively.</p><p>On the client side, server authentication with SSL/TLS looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// With server authentication SSL/TLS
</span><span style=color:#75715e></span>ManagedChannel channel <span style=color:#f92672>=</span> ManagedChannelBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>forAddress</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myservice.example.com&#34;</span><span style=color:#f92672>,</span> 443<span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>GreeterStub</span> stub <span style=color:#f92672>=</span> GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>newStub</span><span style=color:#f92672>(</span>channel<span style=color:#f92672>)</span><span style=color:#f92672>;</span>

<span style=color:#75715e>// With server authentication SSL/TLS; custom CA root certificates; not on Android
</span><span style=color:#75715e></span>ManagedChannel channel <span style=color:#f92672>=</span> NettyChannelBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>forAddress</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myservice.example.com&#34;</span><span style=color:#f92672>,</span> 443<span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>sslContext</span><span style=color:#f92672>(</span>GrpcSslContexts<span style=color:#f92672>.</span><span style=color:#a6e22e>forClient</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>trustManager</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;roots.pem&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>GreeterStub</span> stub <span style=color:#f92672>=</span> GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>newStub</span><span style=color:#f92672>(</span>channel<span style=color:#f92672>)</span><span style=color:#f92672>;</span>
</code></pre></div><h5 id=authenticate-with-google4>Authenticate with Google</h5><p>The following code snippet shows how you can call the <a href=https://cloud.google.com/pubsub/overview>Google Cloud PubSub
API</a> using HRPC with a service
account. The credentials are loaded from a key stored in a well-known location
or by detecting that the application is running in an environment that can
provide one automatically, e.g. Google Compute Engine. While this example is
specific to Google and its services, similar patterns can be followed for other
service providers.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>GoogleCredentials creds <span style=color:#f92672>=</span> GoogleCredentials<span style=color:#f92672>.</span><span style=color:#a6e22e>getApplicationDefault</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
ManagedChannel channel <span style=color:#f92672>=</span> ManagedChannelBuilder<span style=color:#f92672>.</span><span style=color:#a6e22e>forTarget</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;greeter.googleapis.com&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>(</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>GreeterStub</span> stub <span style=color:#f92672>=</span> GreeterGrpc<span style=color:#f92672>.</span><span style=color:#a6e22e>newStub</span><span style=color:#f92672>(</span>channel<span style=color:#f92672>)</span>
    <span style=color:#f92672>.</span><span style=color:#a6e22e>withCallCredentials</span><span style=color:#f92672>(</span>MoreCallCredentials<span style=color:#f92672>.</span><span style=color:#a6e22e>from</span><span style=color:#f92672>(</span>creds<span style=color:#f92672>)</span><span style=color:#f92672>)</span><span style=color:#f92672>;</span>
</code></pre></div><h4 id=nodejs>Node.js</h4><h5 id=base-case--no-encryptionauthentication>Base case - No encryption/authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stub</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>helloworld</span>.<span style=color:#a6e22e>Greeter</span>(<span style=color:#e6db74>&#39;localhost:50051&#39;</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>createInsecure</span>());
</code></pre></div><h5 id=with-server-authentication-ssltls6>With server authentication SSL/TLS</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ssl_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>createSsl</span>(<span style=color:#a6e22e>root_certs</span>);
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stub</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>helloworld</span>.<span style=color:#a6e22e>Greeter</span>(<span style=color:#e6db74>&#39;myservice.example.com&#39;</span>, <span style=color:#a6e22e>ssl_creds</span>);
</code></pre></div><h5 id=authenticate-with-google5>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// Authenticating with Google
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>GoogleAuth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;google-auth-library&#39;</span>); <span style=color:#75715e>// from https://www.npmjs.com/package/google-auth-library
</span><span style=color:#75715e></span>...
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ssl_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>createSsl</span>(<span style=color:#a6e22e>root_certs</span>);
(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GoogleAuth</span>()).<span style=color:#a6e22e>getApplicationDefault</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>auth</span>) {
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>call_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>createFromGoogleCredential</span>(<span style=color:#a6e22e>auth</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>combined_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>combineChannelCredentials</span>(<span style=color:#a6e22e>ssl_creds</span>, <span style=color:#a6e22e>call_creds</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stub</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>helloworld</span>.<span style=color:#a6e22e>Greeter</span>(<span style=color:#e6db74>&#39;greeter.googleapis.com&#39;</span>, <span style=color:#a6e22e>combined_credentials</span>);
});
</code></pre></div><h5 id=authenticate-with-google-using-oauth2-token-legacy-approach>Authenticate with Google using Oauth2 token (legacy approach)</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>GoogleAuth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;google-auth-library&#39;</span>); <span style=color:#75715e>// from https://www.npmjs.com/package/google-auth-library
</span><span style=color:#75715e></span>...
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ssl_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Credentials</span>.<span style=color:#a6e22e>createSsl</span>(<span style=color:#a6e22e>root_certs</span>); <span style=color:#75715e>// load_certs typically loads a CA roots file
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>scope</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://www.googleapis.com/auth/grpc-testing&#39;</span>;
(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GoogleAuth</span>()).<span style=color:#a6e22e>getApplicationDefault</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>auth</span>) {
  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>createScopeRequired</span>()) {
    <span style=color:#a6e22e>auth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>createScoped</span>(<span style=color:#a6e22e>scope</span>);
  }
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>call_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>createFromGoogleCredential</span>(<span style=color:#a6e22e>auth</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>combined_creds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>credentials</span>.<span style=color:#a6e22e>combineChannelCredentials</span>(<span style=color:#a6e22e>ssl_creds</span>, <span style=color:#a6e22e>call_creds</span>);
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stub</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>helloworld</span>.<span style=color:#a6e22e>Greeter</span>(<span style=color:#e6db74>&#39;greeter.googleapis.com&#39;</span>, <span style=color:#a6e22e>combined_credentials</span>);
});
</code></pre></div><h4 id=php>PHP</h4><h5 id=base-case--no-encryptionauthorization>Base case - No encryption/authorization</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$client = new helloworld\GreeterClient(&#39;localhost:50051&#39;, [
    &#39;credentials&#39; =&gt; Grpc\ChannelCredentials::createInsecure(),
]);
...
</code></pre></div><h5 id=authenticate-with-google6>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>function updateAuthMetadataCallback($context)
{
    $auth_credentials = ApplicationDefaultCredentials::getCredentials();
    return $auth_credentials-&gt;updateMetadata($metadata = [], $context-&gt;service_url);
}
$channel_credentials = Grpc\ChannelCredentials::createComposite(
    Grpc\ChannelCredentials::createSsl(file_get_contents(&#39;roots.pem&#39;)),
    Grpc\CallCredentials::createFromPlugin(&#39;updateAuthMetadataCallback&#39;)
);
$opts = [
  &#39;credentials&#39; =&gt; $channel_credentials
];
$client = new helloworld\GreeterClient(&#39;greeter.googleapis.com&#39;, $opts);
</code></pre></div><h5 id=authenticate-with-google-using-oauth2-token-legacy-approach1>Authenticate with Google using Oauth2 token (legacy approach)</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>// the environment variable &#34;GOOGLE_APPLICATION_CREDENTIALS&#34; needs to be set
$scope = &#34;https://www.googleapis.com/auth/grpc-testing&#34;;
$auth = Google\Auth\ApplicationDefaultCredentials::getCredentials($scope);
$opts = [
  &#39;credentials&#39; =&gt; Grpc\Credentials::createSsl(file_get_contents(&#39;roots.pem&#39;));
  &#39;update_metadata&#39; =&gt; $auth-&gt;getUpdateMetadataFunc(),
];
$client = new helloworld\GreeterClient(&#39;greeter.googleapis.com&#39;, $opts);
</code></pre></div><h4 id=dart>Dart</h4><h5 id=base-case--no-encryption-or-authentication6>Base case - no encryption or authentication</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=color:#66d9ef>final</span> channel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClientChannel(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>localhost</span><span style=color:#e6db74>&#39;</span>,
      port: <span style=color:#ae81ff>50051</span>,
      options: <span style=color:#66d9ef>const</span> ChannelOptions(
          credentials: <span style=color:#66d9ef>const</span> ChannelCredentials.insecure()));
<span style=color:#66d9ef>final</span> stub <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GreeterClient(channel);
</code></pre></div><h5 id=with-server-authentication-ssltls7>With server authentication SSL/TLS</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=color:#75715e>// Load a custom roots file.
</span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> trustedRoot <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>roots.pem</span><span style=color:#e6db74>&#39;</span>).readAsBytesSync();
<span style=color:#66d9ef>final</span> channelCredentials <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>new</span> ChannelCredentials.secure(certificates: trustedRoot);
<span style=color:#66d9ef>final</span> channelOptions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChannelOptions(credentials: channelCredentials);
<span style=color:#66d9ef>final</span> channel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClientChannel(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>myservice.example.com</span><span style=color:#e6db74>&#39;</span>,
    options: channelOptions);
<span style=color:#66d9ef>final</span> client <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GreeterClient(channel);
</code></pre></div><h5 id=authenticate-with-google7>Authenticate with Google</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=color:#75715e>// Uses publicly trusted roots by default.
</span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> channel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClientChannel(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>greeter.googleapis.com</span><span style=color:#e6db74>&#39;</span>);
<span style=color:#66d9ef>final</span> serviceAccountJson <span style=color:#f92672>=</span>
     <span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>service-account.json</span><span style=color:#e6db74>&#39;</span>).readAsStringSync();
<span style=color:#66d9ef>final</span> credentials <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JwtServiceAccountAuthenticator(serviceAccountJson);
<span style=color:#66d9ef>final</span> client <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>new</span> GreeterClient(channel, options: credentials.toCallOptions);
</code></pre></div><h5 id=authenticate-a-single-rpc-call1>Authenticate a single RPC call</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=color:#75715e>// Uses publicly trusted roots by default.
</span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> channel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClientChannel(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>greeter.googleapis.com</span><span style=color:#e6db74>&#39;</span>);
<span style=color:#66d9ef>final</span> client <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GreeterClient(channel);
...
<span style=color:#66d9ef>final</span> serviceAccountJson <span style=color:#f92672>=</span>
     <span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>service-account.json</span><span style=color:#e6db74>&#39;</span>).readAsStringSync();
<span style=color:#66d9ef>final</span> credentials <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JwtServiceAccountAuthenticator(serviceAccountJson);
<span style=color:#66d9ef>final</span> response <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>await</span> client.sayHello(request, options: credentials.toCallOptions);
</code></pre></div></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>