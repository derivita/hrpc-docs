

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.css">
<title>HRPC</title>


<link rel="apple-touch-icon" href="/favicons/apple-touch-icon.png">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192" >
<link rel="icon" type="image/png" href="/favicons/android-chrome-512x512.png" sizes="512x512" >
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/site.webmanifest">


    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-60127042-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-60127042-1');
    </script>

  </head>
  <body>
    <div id="landing-content">
      <div class="row">
        <div class="topbannersub">
          <nav class="navbar navbar-expand-md navbar-dark topnav">
            <a class="navbar-brand" href="/">
              <img src="/img/grpc-logo.png" width="114" height="50">
            </a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="topnav, collapse navbar-collapse" id="navbarSupportedContent" style="float:right !important">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item ">
                  <a class="nav-link" href="/about/">About</a>
                </li>
                <li class="nav-item dropdown active">
                  <a class="nav-link dropdown-toggle" href="/docs/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Docs
                  </a>

                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    
                    
                    <a class="dropdown-item" href="/docs">
                      Overview
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/quickstart/">
                      Quick Start
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/guides/">
                      Guides
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/tutorials/">
                      Tutorials
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/reference/">
                      Reference
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/samples/">
                      Samples
                    </a>
                    
                    
                    <a class="dropdown-item" href="/docs/talks">
                      Presentations
                    </a>
                    
                  </div>
                </li>
                <li class="nav-item ">
                  <a class="nav-link" href="/blog">
                    Blog
                  </a> 
                </li>
                <li class="nav-item ">
                  <a class="nav-link" href="/community">Community</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://packages.grpc.io/">
                    Packages
                  </a> 
                </li>
                <li class="nav-item ">
                  <a class="nav-link" href="/faq/">FAQ</a>
                </li>
              </ul>
            </div>
          </nav>
          
          



            <div class="headertext">Documentation</div>
  </div>
        </div>
        </div>

    


<div class="subnav d-none d-md-block">
  <a href="/docs">
    Overview
  </a>

  
  
  
  |
  <a href="/docs/quickstart/">
    Quick Start
  </a>
  
  
  
  |
  <a href="/docs/guides/" class="active">
    Guides
  </a>
  
  
  
  |
  <a href="/docs/tutorials/">
    Tutorials
  </a>
  
  
  
  |
  <a href="/docs/reference/">
    Reference
  </a>
  
</div>


<div class="quickstartcols">

<div class="quickstartcol1">

<h8>Guides</h8>


<a href="/docs/guides/">
  What is HRPC?
</a>


<a href="/docs/guides/concepts/">
  HRPC Concepts
</a>


<a href="/docs/guides/auth/" class="active">
  Authentication
</a>


<a href="/docs/guides/error/">
  Error handling and debugging
</a>


<a href="/docs/guides/benchmarking/">
  Benchmarking
</a>


<a href="https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-HTTP2.md">
  HRPC Wire Format
</a>


<h8 style="margin-top:25%">Related Guides</h8>
  <a href="https://developers.google.com/protocol-buffers/docs/overview">Protocol Buffers</a>
</div>

<div class="quickstartcol2" style="margin-top:4%">
  <h3 style="margin-top:0px;">
    Authentication
  </h3>

  
  <p class="lead">
    This document provides an overview of HRPC authentication, including our built-in supported auth mechanisms, how to plug in your own authentication systems, and examples of how to use HRPC auth in our supported languages.
  </p>
  

  <!-- raw HTML omitted -->
<h3 id="overview">Overview</h3>
<p>HRPC is designed to work with a variety of authentication mechanisms, making it
easy to safely use HRPC to talk to other systems.</p>
<p>HRPC uses HTTP headers for authentication. It provides a pluggable api to encode and
decode the user for a request's HTTP headers. There is also an ACL option that can be specified in the
.proto file to restrict acess to ceertain roles.</p>
<h3 id="concepts">Concepts</h3>
<p>A <strong>UserPrincipal</strong> represents the identity of the person or application calling a remote method.
A <code>UserPrincipal</code> also has 0 or more <strong>Roles</strong>.
An <strong>Authenticator</strong> is responsible for creating the <code>UserPrincipal</code> based on a request's HTTP headers.
A single HRPC server can have multiple authenticators registered.</p>
<p>On the client side a <code>ClientAuth</code> implementation (<code>AuthProvider</code> in TypeScript) sets the headers on a request for the <code>Authenticator</code> to read.</p>
<p>An <strong>ACL</strong> specifies what authenticator types and roles are allowed to access a method or service.</p>
<h3 id="acls">ACLs</h3>
<p>The syntax for an ACL entry is <code>role:{Authenticator}/{RoleID}</code>. An ACL is a list of roles to allow.
Acess is granted if the authenticated user matches any of the roles. If not HRPC returns PermissionDenied,
or Unauthenticated if no user was detected.</p>
<p>ACLs are specified in the <code>.proto</code> file, either for an entire service or for a specific method.
If an ACL is specified on a method and its service, users matching any of the combined acl entries are allowed.</p>
<p>There are several special wildcard values:
Using <code>*</code> for the authenticator id will allow users from any authenticator that match the specified role.
Using <code>*</code> for the role allows any valid user returned by the specified authenticator.
Using <code>**</code> for the role allows any valid user from the specified authenticator, or no user at all.</p>
<p>For example, say you have two authenticators registered: &ldquo;google&rdquo; and &ldquo;session&rdquo;. The entry &ldquo;role:google/<em>&rdquo; allows any signed in user from the &ldquo;google&rdquo; authenticator, while &ldquo;role:</em>/*&rdquo; allows any signed in user from either authenticator. The entry &ldquo;role:google/**&rdquo; would only accept users returned by the &ldquo;google&rdquo; authenticator, but it allows no user to be signed in.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-proto" data-lang="proto"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;tools/hrpc/options.proto&#34;</span>;  <span style="color:#75715e">// required for specifying ACLs
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">service</span> StudentService {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// Service ACLs apply to all methods
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">option</span> (<span style="color:#f92672">.</span>hrpc.service)<span style="color:#f92672">.</span>acl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;role:myauth/student&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">service</span> OtherService {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">rpc</span> Get (GetRequest) <span style="color:#66d9ef">returns</span> (GetResponse) {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">//  Method ACLs apply to a single method.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">option</span> (<span style="color:#f92672">.</span>hrpc.rpc)<span style="color:#f92672">.</span>acl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;role:myauth/read&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#75715e">// Multiple ACLs are ORed together.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">option</span> (<span style="color:#f92672">.</span>hrpc.rpc)<span style="color:#f92672">.</span>acl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;role:myauth/write&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">rpc</span> Set (SetRequest) <span style="color:#66d9ef">returns</span> (SetResponse) {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">option</span> (<span style="color:#f92672">.</span>hrpc.rpc)<span style="color:#f92672">.</span>acl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;role:myauth/write&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h3 id="server-authentication-api">Server Authentication API</h3>
<p><code>UserPrincipal</code> is a simple struct:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">UserPrincipal</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Authenticator</span> <span style="color:#66d9ef">string</span>  <span style="color:#75715e">// ID of the Authenticator which authenticated this user.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ID</span>            <span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Authenticator specific user id.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Roles</span>         []<span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Metadata</span>      <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}  <span style="color:#75715e">// Any extra information set by the Authenticator
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Inside a server method, you can access the current <code>UserPrinciple</code> with the function <code>hrpc.UserFromContext</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">UserFromContext</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Context</span>())
</code></pre></div><p>To add an authenticator type, implement the <code>Authenticator</code> interface:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Authenticator</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">Authenticate</span>(<span style="color:#a6e22e">req</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">UserPrincipal</span>
}
</code></pre></div><p>and then register it with your server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">rpcServer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">NewServer</span>()
<span style="color:#a6e22e">rpcServer</span>.<span style="color:#a6e22e">RegisterAuthenticator</span>(<span style="color:#e6db74">&#34;myauth&#34;</span>, <span style="color:#a6e22e">NewAuthImpl</span>())
</code></pre></div><h3 id="go-client-authentication-api">Go Client Authentication API</h3>
<p>The <code>ClientAuth</code> interface is responsible for setting auth headers. You specify it when creating a Client.
For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">tokenAuth</span> <span style="color:#66d9ef">string</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">t</span> <span style="color:#a6e22e">tokenAuth</span>) <span style="color:#a6e22e">SetAuthHeaders</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
    <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>, <span style="color:#e6db74">&#34;Bearer &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">t</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewTokenAuthClient</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">token</span> <span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">Client</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">Client</span>{<span style="color:#a6e22e">ServerURL</span>: <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">Auth</span>: <span style="color:#a6e22e">tokenAuth</span>(<span style="color:#a6e22e">token</span>)}
}
</code></pre></div><h3 id="typescript-client-authentication-api">TypeScript Client Authentication API</h3>
<p>The <code>AuthProvider</code> interface is responsible for setting auth headers. You specify it when creating a Client.
For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TokenAuth</span> {
    <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">token_</span>:<span style="color:#66d9ef">string</span>){}
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">GetAuthHeaders() {</span> <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;Authorization&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">Bearer </span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">token_</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>};}
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">url</span>:<span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">token</span>: <span style="color:#66d9ef">string</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">hrpc</span>.<span style="color:#a6e22e">Client</span>(<span style="color:#a6e22e">url</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TokenAuth</span>(<span style="color:#a6e22e">token</span>));
    }
}
</code></pre></div>
</div>
</div>

</div>

          
          

      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  </body>
</html>
